<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rainfall Map Display</title>

    <!-- Refresh every 5 minutes -->
    <meta http-equiv="refresh" content="300">

    <style>
        body {
            margin: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        /* Map Image with fade-in */
        #rainImg {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        /* 游대 Minimal Switch Icon */
        #switchIcon {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: #222;
            border: 2px solid #00eaff;
            color: #00eaff;
            font-size: 24px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #00eaff;
            opacity: 1;
            transition: opacity 0.5s ease-out, transform 0.2s ease;
            z-index: 9999;
        }

        #switchIcon:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px #00eaff;
        }

        /* Live clock (top-right) */
        #clock {
            position: fixed;
            top: 10px;
            right: 20px;
            color: #00eaff;
            font-size: 24px;
            letter-spacing: 1px;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            z-index: 9999;
        }

        /* Auto-refresh countdown (bottom-left) */
        #refreshTimer {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #00eaff;
            font-size: 20px;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            z-index: 9999;
        }
    </style>
</head>

<body>

    <!-- 游대 Switch to GSMaP Live -->
    <button id="switchIcon" onclick="goToGSMaP()">游대</button>

    <!-- Live Clock (top-right) -->
    <div id="clock"></div>

    <!-- Auto-refresh countdown (bottom-left) -->
    <div id="refreshTimer"></div>

    <!-- Rainfall Map Image -->
    <img id="rainImg"
        src="https://www.dropbox.com/scl/fi/5g9rdxoju3lup0sxldihm/present_rainfall_plot_NE.png?rlkey=3sqyvyc2my0dezm5ynu5xunfp&raw=1&cb=1"
        alt="Rainfall Map">

    <script>
        // ===============================
        // Auto-Fullscreen on Page Load
        // ===============================
        function autoFullscreen() {
            let elem = document.documentElement;
            if (!document.fullscreenElement) {
                elem.requestFullscreen().catch(() => {});
            }
        }
        setTimeout(autoFullscreen, 1000);

        // ===============================
        // Auto-Hide Switch Icon, Clock, Timer
        // ===============================
        let switchIcon = document.getElementById("switchIcon");
        let clock = document.getElementById("clock");
        let refreshTimer = document.getElementById("refreshTimer");
        let hideTimeout;

        function resetHideTimer() {
            switchIcon.style.opacity = 1;
            clock.style.opacity = 1;
            refreshTimer.style.opacity = 1;

            clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                switchIcon.style.opacity = 0;
                clock.style.opacity = 0;
                refreshTimer.style.opacity = 0;
            }, 5000);
        }

        document.onmousemove = resetHideTimer;
        document.ontouchstart = resetHideTimer;
        resetHideTimer();

        // ===============================
        // 游대 Switch Back to GSMaP Page
        // ===============================
        function goToGSMaP() {
            window.location.href = "https://sushantakundu.github.io/gsmap-live/";
        }

        // ===============================
        // Image Loader with Retry + Fade
        // ===============================
        let img = document.getElementById("rainImg");

        function loadImage() {
            img.style.opacity = 0;

            img.src =
                "https://www.dropbox.com/scl/fi/5g9rdxoju3lup0sxldihm/present_rainfall_plot_NE.png" +
                "?rlkey=3sqyvyc2my0dezm5ynu5xunfp&raw=1&cb=" + Date.now();

            img.onload = () => {
                img.style.opacity = 1;
            };

            img.onerror = () => {
                console.log("Image failed to load. Retrying in 5 seconds...");
                setTimeout(loadImage, 5000);
            };
        }

        loadImage();
        setInterval(loadImage, 300000); // 5 minutes

        // ===============================
        // Live Digital Clock
        // ===============================
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString("en-IN", {
                hour: "2-digit",
                minute: "2-digit",
                second: "2-digit"
            });
            clock.textContent = timeString;
        }

        setInterval(updateClock, 1000);
        updateClock();

        // ===============================
        // Auto-Refresh Countdown Timer
        // ===============================
        let refreshSeconds = 300; // 5 minutes
        function updateRefreshTimer() {
            let mins = Math.floor(refreshSeconds / 60);
            let secs = refreshSeconds % 60;

            refreshTimer.textContent =
                "Auto refresh in: " +
                mins + ":" + (secs < 10 ? "0" + secs : secs);

            refreshSeconds--;

            if (refreshSeconds < 0) {
                refreshSeconds = 300;
            }
        }

        setInterval(updateRefreshTimer, 1000);
        updateRefreshTimer();
    </script>

</body>
</html>
